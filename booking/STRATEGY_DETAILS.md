# 订单流交易策略详细说明

## 当前实现的策略

是的，当前已经实现了一个**基于订单簿失衡和交易流的交易策略**。以下是具体的策略逻辑：

## 策略核心逻辑

### 1. 信号生成规则

策略通过综合分析以下4个指标来生成交易信号：

#### 指标1: 订单簿失衡 (权重: 40%)
- **买入信号**: 当订单簿失衡比率 > 失衡阈值（默认0.6）时
  - 失衡比率 = (买单总量 - 卖单总量) / 总订单量
  - 信号强度贡献 = 失衡比率绝对值 × 0.4
  
- **卖出信号**: 当订单簿失衡比率 < -失衡阈值时
  - 信号强度贡献 = 失衡比率绝对值 × 0.4

#### 指标2: 加权失衡 (权重: 30%)
- **买入信号**: 当加权失衡比率 > 失衡阈值时
  - 加权失衡：距离价格越近的订单权重越大
  - 信号强度贡献 = 加权失衡比率绝对值 × 0.3
  
- **卖出信号**: 当加权失衡比率 < -失衡阈值时
  - 信号强度贡献 = 加权失衡比率绝对值 × 0.3

#### 指标3: 交易流失衡 (权重: 20%)
- **买入信号**: 当交易流失衡比率 > 0.3 时
  - 交易流失衡 = (买入成交量 - 卖出成交量) / 总成交量
  - 信号强度贡献 = 交易流失衡比率绝对值 × 0.2
  
- **卖出信号**: 当交易流失衡比率 < -0.3 时
  - 信号强度贡献 = 交易流失衡比率绝对值 × 0.2

#### 指标4: 价格动量 (权重: 10%)
- **买入信号**: 当价格动量 > 0.1% 时
  - 动量 = (最新价格 - 10秒前价格) / 10秒前价格
  - 信号强度贡献 = min(动量绝对值 × 100, 0.1)
  
- **卖出信号**: 当价格动量 < -0.1% 时
  - 信号强度贡献 = min(动量绝对值 × 100, 0.1)

### 2. 信号强度计算

总信号强度 = 各指标贡献之和（最大为1.0）

**信号生效条件**:
- 总信号强度 ≥ 信号强度阈值（默认0.7）
- 至少有一个指标触发

### 3. 信号确认机制

策略使用**多信号确认机制**来减少假信号：

1. **信号缓冲**: 将生成的信号存入缓冲区
2. **方向一致性检查**: 需要连续N个信号（默认3个）方向一致
3. **强度检查**: 这N个信号的平均强度 ≥ 信号强度阈值
4. **执行**: 只有通过确认的信号才会被执行

### 4. 入场价格

- **买入**: 使用当前卖一价（best_ask）
- **卖出**: 使用当前买一价（best_bid）

### 5. 风险控制

#### 持仓限制
- 最大持仓: 默认1.0（可配置）
- 买入时检查: 当前持仓 < 最大持仓
- 卖出时检查: 当前持仓 > -最大持仓

#### 订单频率控制
- 每分钟最大订单数: 默认5笔
- 检查订单间隔时间

#### 每日亏损限制
- 可设置每日最大亏损金额
- 达到限制后停止交易

### 6. 止损止盈（待完善）

当前代码框架已包含止损止盈参数，但自动管理逻辑需要进一步完善：
- 止损百分比: 默认2%
- 止盈百分比: 默认1%

## 策略示例

### 场景1: 强烈买入信号

```
订单簿失衡: +0.7 (买单占优70%)
加权失衡: +0.65
交易流失衡: +0.4
价格动量: +0.15%

信号强度计算:
= 0.7 × 0.4 + 0.65 × 0.3 + 0.4 × 0.2 + 0.15 × 0.1
= 0.28 + 0.195 + 0.08 + 0.015
= 0.57

如果连续3个tick都生成类似强度的买入信号，且平均强度≥0.7，则执行买入
```

### 场景2: 卖出信号

```
订单簿失衡: -0.8 (卖单占优80%)
加权失衡: -0.75
交易流失衡: -0.5
价格动量: -0.2%

信号强度计算:
= 0.8 × 0.4 + 0.75 × 0.3 + 0.5 × 0.2 + 0.2 × 0.1
= 0.32 + 0.225 + 0.1 + 0.02
= 0.665

如果连续3个tick都生成类似强度的卖出信号，且平均强度≥0.7，则执行卖出
```

## 策略特点

### 优点
1. **多指标综合**: 结合订单簿和交易流，减少单一指标的误判
2. **信号确认**: 多信号确认机制减少假信号
3. **实时响应**: 基于实时订单簿和交易流数据
4. **风险控制**: 完善的持仓和频率限制

### 局限性
1. **需要流动性**: 在流动性不足的市场可能产生假信号
2. **延迟执行**: 信号确认机制可能导致入场延迟
3. **止损止盈**: 自动管理逻辑需要完善
4. **交易所适配**: 部分交易所的订单簿深度API需要适配

## 参数调优建议

### 保守策略
```bash
--imbalance-threshold 0.7
--signal-strength-threshold 0.8
--confirmation-ticks 5
--position-size 0.05
```

### 激进策略
```bash
--imbalance-threshold 0.5
--signal-strength-threshold 0.6
--confirmation-ticks 2
--position-size 0.2
```

### 平衡策略（推荐）
```bash
--imbalance-threshold 0.6
--signal-strength-threshold 0.7
--confirmation-ticks 3
--position-size 0.1
```

## 未来改进方向

1. **止损止盈自动管理**: 完善持仓的止损止盈逻辑
2. **更多指标**: 添加更多订单流指标（如订单取消率、大单追踪等）
3. **机器学习**: 使用ML模型优化信号权重
4. **回测系统**: 添加历史数据回测功能
5. **多时间框架**: 结合不同时间框架的订单流分析
