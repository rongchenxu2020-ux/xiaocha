# 做市商机器人测试 - GUI监控指南

## 概述

这个测试工具可以启动做市商机器人在模拟模式下运行，并通过GUI界面实时监控机器人的状态和交易信号。

## 功能特点

✅ **模拟模式运行**: 机器人不会实际下单，安全测试  
✅ **GUI实时监控**: 图形界面显示机器人状态  
✅ **信号跟踪**: 实时显示买卖订单和价差信息  
✅ **自动刷新**: GUI每3秒自动更新一次  
✅ **多机器人支持**: 可以同时监控多个机器人  

## 快速开始

### Windows

```bash
# 方法1: 使用批处理文件（推荐）
booking\start_test_market_maker.bat

# 方法2: 直接运行Python脚本
python booking\test_market_maker_gui.py
```

### Linux/macOS

```bash
# 方法1: 使用Shell脚本
bash booking/start_test_market_maker.sh

# 方法2: 直接运行Python脚本
python3 booking/test_market_maker_gui.py
```

## 使用步骤

1. **启动测试脚本**
   ```bash
   python booking/test_market_maker_gui.py
   ```

2. **按提示操作**
   - 脚本会提示按 Enter 键开始
   - 首先会启动GUI监控工具
   - 然后启动做市商机器人（模拟模式）

3. **查看GUI界面**
   - GUI会自动打开，显示机器人状态
   - 在"机器人状态"标签页查看运行中的机器人
   - 在"交易信号"标签页查看实时交易信号

4. **停止测试**
   - 在终端按 `Ctrl+C` 停止机器人
   - GUI窗口可以保持打开，继续监控其他机器人

## GUI界面说明

### 机器人状态标签页

显示所有运行的机器人信息：

| 列名 | 说明 |
|------|------|
| PID | 进程ID |
| 交易所 | 交易所名称（如EDGEX） |
| 交易对 | 交易对（如ETH, BTC, SOL） |
| 模式 | 模拟模式/真实交易 |
| 运行时长 | 机器人运行时间 |
| 信号总数 | 记录的状态总数 |
| 买入 | 买单数量 |
| 卖出 | 卖单数量 |
| 已确认 | 活跃状态数量 |

### 交易信号标签页

显示做市商机器人的实时状态：

- **买单价格**: 当前挂的买单价格
- **卖单价格**: 当前挂的卖单价格
- **中间价**: 市场中间价
- **价差**: 买卖价差
- **持仓**: 当前持仓数量
- **订单ID**: 买单和卖单的订单ID

## 测试配置

默认测试配置：
- **交易所**: EdgeX
- **交易对**: ETH
- **订单大小**: 0.1
- **价差比例**: 0.5 (市场价差的50%)
- **最大持仓**: 1.0
- **模式**: 模拟模式（不会实际下单）

## 自定义测试

可以修改 `test_market_maker_gui.py` 中的参数：

```python
cmd = [
    sys.executable,
    str(bot_script),
    "--exchange", "edgex",      # 交易所
    "--ticker", "SOL",          # 交易对
    "--order-size", "0.1",      # 订单大小
    "--spread-ratio", "0.5",    # 价差比例
    "--max-position", "1.0",    # 最大持仓
    "--simulate",               # 模拟模式
    "--enable-logging"          # 启用日志
]
```

## 日志文件

测试过程中会生成日志文件：

- **位置**: `logs/market_maker_signals_{exchange}_{ticker}_simulate_{date}.csv`
- **格式**: CSV文件，包含时间戳、买卖价格、中间价、价差、持仓等信息

## 注意事项

1. **模拟模式**: 测试脚本默认使用模拟模式，不会实际下单
2. **GUI刷新**: GUI每3秒自动刷新一次，也可以点击"立即刷新"按钮
3. **多机器人**: 可以同时运行多个机器人，GUI会显示所有运行的机器人
4. **停止机器人**: 在终端按 `Ctrl+C` 停止机器人，GUI会继续显示最后的状态

## 故障排除

### GUI无法启动
- 确保已安装 tkinter: `pip install tk`
- Windows通常自带tkinter，Linux可能需要安装: `sudo apt-get install python3-tk`

### 机器人无法启动
- 检查 `.env` 文件是否存在并配置正确
- 检查网络连接
- 查看终端错误信息

### GUI显示无机器人
- 确保机器人正在运行
- 检查进程是否在运行: `ps aux | grep run_market_maker_bot`
- 点击"立即刷新"按钮

## 示例输出

```
========================================
做市商机器人测试 - GUI监控模式
========================================

正在启动GUI监控工具...
GUI监控工具已启动

正在启动做市商机器人...
========================================
启动做市商机器人（模拟模式）...
========================================

机器人已启动！
========================================
现在可以:
  - 在GUI中查看机器人状态和交易信号
  - 查看实时日志输出
  - 按 Ctrl+C 停止机器人
```

## 相关文件

- `test_market_maker_gui.py` - 测试脚本主文件
- `monitor_bots_gui.py` - GUI监控工具
- `run_market_maker_bot.py` - 做市商机器人
- `market_maker_strategy.py` - 做市商策略实现
